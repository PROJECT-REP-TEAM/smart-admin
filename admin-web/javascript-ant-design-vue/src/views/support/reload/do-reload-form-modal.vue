<!--
 * @Description:
 * @version:
 * @Author: zhuoda
 * @Date: 2021-09-01 20:58:51
 * @LastEditors: zhuoda
 * @LastEditTime: 2022-06-22
-->
<template>
  <a-modal
    :visible="visible"
    title="执行Reload"
    ok-text="确认"
    cancel-text="取消"
    @ok="onSubmit"
    @cancel="onClose"
  >
    <a-form ref="formRef" :model="form" :rules="rules" :label-col="{ span: 5 }">
      <a-form-item label="标签">
        <a-input v-model:value="form.tag" :disabled="true" />
      </a-form-item>
      <a-form-item label="运行标识" name="identification">
        <a-input v-model:value="form.identification" placeholder="请输入运行标识" />
      </a-form-item>
      <a-form-item label="参数" name="args">
        <a-input v-model:value="form.args" placeholder="请输入参数" />
      </a-form-item>
    </a-form>
  </a-modal>
</template>
<script setup>
import { ref, reactive } from "vue";
import { ValidateErrorEntity } from "ant-design-vue/lib/form/interface";
import { message } from "ant-design-vue";
import { useSpinStore } from "/@/store/modules/system/spin";
import { configApi } from "../../../api/support/config/config-api";
import { reloadApi } from "/@/api/support/reload/reload-api";

// emit
const emit = defineEmits(["refresh"]);
defineExpose({
  showModal,
});

// ----------------------- 表单 隐藏 与 显示 ------------------------
// 是否展示
const visible = ref(false);
function showModal(tag) {
  form.tag = tag;
  form.identification = "";
  form.args = "";
  visible.value = true;
}

function onClose() {
  Object.assign(form, formDefault);
  visible.value = false;
}

//  组件
const formRef = ref();

const formDefault = {
  tag: "",
  identification: "",
  args: "",
};
let form = reactive({ ...formDefault });
const rules = {
  identification: [{ required: true, message: "请输入运行标识" }],
  args: [{ required: true, message: "请输入参数值" }],
};

// ----------------------- 提交 ------------------------

function onSubmit() {
  formRef.value
    .validate()
    .then(async () => {
      useSpinStore().show();
      try {
        await reloadApi.reload(form);
        message.success("reload成功");
        emit("refresh");
        onClose();
      } catch (error) {
        console.log(error);
      } finally {
        useSpinStore().hide();
      }
    })
    .catch((error) => {
      console.log("error", error);
      message.error("参数验证错误，请仔细填写表单数据!");
    });
}
</script>
